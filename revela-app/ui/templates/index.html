<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>revela</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,{{ logo_base64 }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header with logo -->
        <header class="header">
            {% if logo_base64 %}
            <div class="logo-container">
                <img src="data:image/png;base64,{{ logo_base64 }}" alt="Revela Logo" class="logo">
                <div class="title-container">
                    <h1>revela</h1>
                    <p class="subtitle">Data Copilot for the Web powered by Google Gemma 3</p>
                </div>
            </div>
            {% else %}
            <div class="title-container">
                <h1>revela</h1>
                <p class="subtitle">Data Copilot for the Web powered by Google Gemma 3</p>
            </div>
            {% endif %}
        </header>

        <hr>

        <!-- Ollama Health Status -->
        {% if not ollama_healthy %}
        <div class="alert alert-error">
            <strong>‚ö†Ô∏è Cannot connect to Ollama service</strong><br>
            Please check your configuration at {{ ollama_host }}
        </div>
        {% endif %}

        <!-- Extension Detection Alert -->
        <div id="extension-alert" class="alert alert-warning">
            <strong>‚ö†Ô∏è Extension Not Detected</strong><br>
            Please install the <strong>Revela Chrome Extension</strong> to get AI insights 
            directly on any chart or table while browsing.
            <br><br>
            <a href="https://github.com/mmohanram13/revela/releases/download/0.0.1/revela_chrome_extension.zip" 
               class="btn btn-primary" 
               download
               style="margin-right: 10px;">
                üì• Download Extension
            </a>
            <button id="confirm-extension-btn" class="btn btn-secondary">
                ‚úì I have installed the extension
            </button>
        </div>

        <!-- Extension Confirmed Message -->
        <div id="extension-confirmed" class="alert alert-success" style="display: none;">
            <strong>‚úì Extension Detected</strong><br>
            You're all set! Use the extension while browsing or analyze images below.
        </div>

        <hr>

        <!-- Main Analysis Form -->
        <div class="analysis-section">
            <h2>Analyze Chart or Table</h2>
            
            <form id="analysis-form">
                <!-- Omni Search Box -->
                <div class="form-group">
                    <label for="prompt">Ask anything about your chart or table:</label>
                    <textarea 
                        id="prompt" 
                        name="prompt" 
                        rows="3" 
                        class="omni-search"
                        placeholder="What trends do you see? Summarize this data... Ask anything!"
                        required
                    ></textarea>
                </div>

                <!-- Image Upload Section -->
                <div class="form-group">
                    <div class="upload-container">
                        <div class="upload-method">
                            <label for="image-upload" class="upload-label">
                                üìé <strong>Paste to attach image or upload</strong>
                            </label>
                            <input 
                                type="file" 
                                id="image-upload" 
                                name="image" 
                                accept="image/png,image/jpeg,image/jpg"
                            >
                            <div class="upload-hint">
                                Paste (Ctrl+V / Cmd+V) or choose file, then click Analyze
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image Preview -->
                <div id="image-preview-container" style="display: none;">
                    <h4>Uploaded Image:</h4>
                    <div class="image-preview">
                        <img id="image-preview" src="" alt="Preview">
                        <button type="button" id="remove-image" class="btn btn-small">Remove</button>
                    </div>
                </div>

                <hr>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary" id="analyze-btn">
                    Analyze
                </button>
            </form>

            <!-- Response Section -->
            <div id="response-section" style="display: none;">
                <hr>
                <h3>Analysis Result:</h3>
                <div id="response-content" class="response-box"></div>
                <div id="loading-indicator" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <span>Analyzing...</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <hr>
        <footer class="footer">
            <p>Running in <strong>{{ environment }}</strong> mode | Model: <strong>{{ model }}</strong></p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='index.js') }}"></script>
</body>
</html>
